<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tomohisa Sasaki | Research Profile</title>
  <!-- Fonts: clean, legible sans for English copy -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=Poppins:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.upgraded.css">
  <meta name="color-scheme" content="light only">
</head>
<body>
  <!-- Page loader (Uiverse grumpy-turtle-41 inspired) -->
  <div class="page-loader is-on" data-page-loader role="status" aria-live="polite" aria-label="Loading">
    <div class="gt-spinner" aria-hidden="true">
      <span class="gt-dot" style="--i:0"></span>
      <span class="gt-dot" style="--i:1"></span>
      <span class="gt-dot" style="--i:2"></span>
      <span class="gt-dot" style="--i:3"></span>
      <span class="gt-dot" style="--i:4"></span>
      <span class="gt-dot" style="--i:5"></span>
      <span class="gt-dot" style="--i:6"></span>
      <span class="gt-dot" style="--i:7"></span>
      <span class="gt-dot" style="--i:8"></span>
      <span class="gt-dot" style="--i:9"></span>
      <span class="gt-dot" style="--i:10"></span>
      <span class="gt-dot" style="--i:11"></span>
    </div>
    <p class="page-loader__label">Loading</p>
  </div>

  <!-- background -->
  <div class="bg-swirl" aria-hidden="true">
    <div class="bg-swirl__ring bg-swirl__ring--one"></div>
    <div class="bg-swirl__ring bg-swirl__ring--two"></div>
    <div class="bg-swirl__gradient"></div>
  </div>

  <div class="page">
    <!-- Left rail -->
    <aside class="profile-panel" aria-label="Profile and navigation">
      <div class="profile-card" data-motion>
        <span class="profile-card__glow" aria-hidden="true"></span>
        <div class="profile-card__status">
          <span class="profile-card__pill profile-card__pill--live">Live</span>
          <span class="profile-card__pill profile-card__pill--role">CSAIL</span>
        </div>
        <figure class="profile-card__avatar">
          <img src="image.png" alt="Tomohisa Sasaki portrait" loading="lazy">
        </figure>
        <div class="profile-card__meta">
          <p class="profile-card__label">Human–AI Researcher</p>
          <h1 class="profile-card__name">Tomohisa Sasaki</h1>
          <div class="profile-card__tags">
            <span>#AI</span>
            <span>#Finance</span>
            <span>#Healthcare</span>
          </div>
          <p class="profile-card__annotation">Neuro‑adaptive systems · Behavioral economics · Embodied intelligence</p>
        </div>
        <div class="profile-card__metrics">
          <div>
            <span class="profile-card__metric-label">Collaborations</span>
            <strong>24+</strong>
          </div>
          <div>
            <span class="profile-card__metric-label">Prototypes</span>
            <strong>12</strong>
          </div>
          <div>
            <span class="profile-card__metric-label">Mentorship</span>
            <strong>18</strong>
          </div>
        </div>
        <a class="profile-card__cta qc-btn" href="#contact" aria-label="Request collaboration">Request Collaboration</a>
      </div>

      <!-- Scroll-spy nav with animated indicator -->
      <nav class="profile-nav" aria-label="Sections">
        <span class="profile-nav__indicator" aria-hidden="true"></span>
        <button class="profile-nav__item is-active" data-nav-target="#bio">Bio</button>
        <button class="profile-nav__item" data-nav-target="#research">Research</button>
        <button class="profile-nav__item" data-nav-target="#products">Products</button>
        <button class="profile-nav__item" data-nav-target="#contact">Contact</button>
      </nav>

      <!-- LinkedIn card (iframe is blocked by LinkedIn; we use an accessible follow card) -->
      <a class="embed-card embed-card--linkedin" href="https://www.linkedin.com/in/tomohisa-sasaki" target="_blank" rel="noreferrer" data-tooltip="Open LinkedIn profile">
        <div class="embed-card__icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
            <path d="M4.98 3.5C4.98 4.88 3.88 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1s2.48 1.12 2.48 2.5zM.5 8h4V24h-4V8zm7.5 0h3.8v2.2h.05c.53-1 1.82-2.2 3.74-2.2 4 0 4.74 2.6 4.74 5.9V24h-4v-7.6c0-1.8-.03-4.1-2.5-4.1-2.5 0-2.9 1.9-2.9 4v7.7h-4V8z"></path>
          </svg>
        </div>
        <div class="embed-card__body">
          <p class="embed-card__label">LinkedIn</p>
          <p class="embed-card__title">@tomohisa-ai</p>
          <p class="embed-card__meta">Updates on AI × Finance</p>
        </div>
        <span class="embed-card__status">Follow</span>
      </a>

      <!-- Social buttons (Uiverse smooth-crab-52 vibe) -->
      <div class="social-buttons" role="group" aria-label="Social profiles">
        <a class="social-btn social-btn--x" href="https://twitter.com/" target="_blank" rel="noreferrer" aria-label="Open X/Twitter">X</a>
        <a class="social-btn social-btn--gh" href="https://github.com/" target="_blank" rel="noreferrer" aria-label="Open GitHub">GitHub</a>
      </div>

      <a class="floating-cta qc-btn qc-btn--ghost" href="#research">See Latest Research</a>
    </aside>

    <!-- Main content -->
    <main class="content">
      <!-- Bio -->
      <section id="bio" class="section" data-motion>
        <header class="section__header">
          <p class="section__eyebrow">Career Timeline</p>
          <h2 class="section__title">Bio</h2>
          <p class="section__lead">From MIT to Google AI—follow a bottom‑to‑top arc of research milestones.</p>
        </header>
        <div class="timeline" role="list">
          <article class="timeline__item" role="listitem">
            <div class="timeline__year">2019</div>
            <div class="timeline__body">
              <h3>MITES Summer Program @ MIT</h3>
              <p>Started cross‑disciplinary exploration at the intersection of behavioral science and machine learning.</p>
            </div>
          </article>
          <article class="timeline__item" role="listitem">
            <div class="timeline__year">2022</div>
            <div class="timeline__body">
              <h3>Research Assistant, MIT CSAIL</h3>
              <p>Worked on human‑centered AI and authored guidance for deploying AI in mental‑health settings.</p>
            </div>
          </article>
          <article class="timeline__item" role="listitem">
            <div class="timeline__year">2024</div>
            <div class="timeline__body">
              <h3>Google AI Researcher</h3>
              <p>Led explainable agents across AI × Finance while collaborating with clinical partners.</p>
            </div>
          </article>
        </div>
      </section>

      <!-- Research -->
      <section id="research" class="section" data-motion>
        <header class="section__header">
          <p class="section__eyebrow">AI × Healthcare</p>
          <h2 class="section__title">Research</h2>
        </header>
        <div class="research-grid">
          <div class="research-grid__text">
            <p>
              Building a hybrid AI stack at the boundary of AI and healthcare that can read EEG/fMRI and digital biomarkers.
              We rapidly interpret personal neural data and create protocols that support clinical decision‑making.
            </p>
            <ul>
              <li>Multi‑resolution neural analysis with interactive attention maps</li>
              <li>Intervention simulator grounded in behavioral‑economics models</li>
              <li>Explainable dashboards for clinicians and patients</li>
            </ul>
          </div>
          <div class="research-grid__visual" aria-hidden="true">
            <div class="research-orb">
              <span class="research-orb__pulse"></span>
              <span class="research-orb__node research-orb__node--one"></span>
              <span class="research-orb__node research-orb__node--two"></span>
              <span class="research-orb__node research-orb__node--three"></span>
            </div>
            <p class="research-grid__caption">Neuro‑pattern decoding pipeline</p>
          </div>
        </div>
        <div class="research-panels">
          <article class="research-panel">
            <div class="research-panel__icon" aria-hidden="true">01</div>
            <h3>Neural capture</h3>
            <p>Extract behavioral context from dense EEG/MEG and shape a personalized feature space.</p>
          </article>
          <article class="research-panel">
            <div class="research-panel__icon" aria-hidden="true">02</div>
            <h3>Adaptive inference</h3>
            <p>Use graph Transformers to infer multivariate signals from neural + vital streams in real time.</p>
          </article>
          <article class="research-panel">
            <div class="research-panel__icon" aria-hidden="true">03</div>
            <h3>Clinical UX</h3>
            <p>Story‑cards make interventions explainable and align physician–patient decisions.</p>
          </article>
        </div>
      </section>

      <!-- Products -->
      <section id="products" class="section" data-motion>
        <header class="section__header">
          <p class="section__eyebrow">Product Stories</p>
          <h2 class="section__title">Products</h2>
          <p class="section__lead">A decision‑support tool for Finance and a full‑stack prototype for strength training.</p>
        </header>

        <!-- Uiverse-inspired chip tabs -->
        <div class="product-chips" role="tablist" aria-label="Filter products">
          <button class="product-chip is-selected" role="tab" aria-selected="true" data-filter="all">All</button>
          <button class="product-chip product-chip--finance" role="tab" aria-selected="false" data-filter="finance">Finance</button>
          <button class="product-chip product-chip--muscle" role="tab" aria-selected="false" data-filter="muscle">Muscle</button>
          <button class="product-chip product-chip--health" role="tab" aria-selected="false" data-filter="health">Healthcare</button>
        </div>
        <div class="visually-hidden" aria-live="polite" data-products-status>All products shown</div>

        <div class="product-grid">
          <article class="product-card product-card--finance" data-product="finance">
            <div class="product-card__header">
              <p class="product-card__eyebrow">Finance Signal Lab</p>
              <h3>Alpha Canvas</h3>
            </div>
            <p class="product-card__body">
              Cross‑analyzes earnings text, ESG signals, and macro factors; then surfaces risks & opportunities through pastel visualizations.
            </p>
            <ul class="product-card__list">
              <li>Natural‑language graphs × financial fundamentals</li>
              <li>Parallel comparison of Risk · Alpha · Impact indicators</li>
              <li>AI recommendations balanced with human accountability</li>
            </ul>
          </article>

          <article class="product-card product-card--muscle" data-product="muscle">
            <div class="product-card__header">
              <p class="product-card__eyebrow">Embodied Intelligence</p>
              <h3>Muscle Log Companion</h3>
            </div>
            <p class="product-card__body">
              A polished take on the Flask prototype—log sessions across devices and review trends with a trainer‑first UI.
            </p>
            <div class="trainer-wrapper">
              <div class="trainer-sim" data-trainer>
                <header class="trainer-sim__header">
                  <div>
                    <p class="trainer-sim__eyebrow">Session builder</p>
                    <h4>Weekly progressive plan</h4>
                  </div>
                  <div class="trainer-sim__period" data-trainer-period></div>
                </header>
                <div class="trainer-sim__layout">
                  <section class="trainer-editor" aria-label="Compose session">
                    <label class="trainer-label" for="trainer-date">Date</label>
                    <input class="trainer-input" type="date" id="trainer-date" data-trainer-date>

                    <label class="trainer-label" for="trainer-focus">Focus</label>
                    <select class="trainer-input" id="trainer-focus" data-trainer-focus>
                      <option value="chest">Chest</option>
                      <option value="shoulders">Shoulders</option>
                      <option value="arms">Arms</option>
                      <option value="legs">Legs</option>
                      <option value="back">Back</option>
                    </select>

                    <label class="trainer-label" for="trainer-movement">Movement</label>
                    <select class="trainer-input" id="trainer-movement" data-trainer-movement></select>

                    <div class="trainer-grid">
                      <div>
                        <label class="trainer-label" for="trainer-sets">Sets</label>
                        <input class="trainer-input" type="number" id="trainer-sets" min="1" max="8" value="3" data-trainer-sets>
                      </div>
                      <div>
                        <label class="trainer-label" for="trainer-reps">Reps</label>
                        <input class="trainer-input" type="number" id="trainer-reps" min="1" max="25" value="8" data-trainer-reps>
                      </div>
                      <div>
                        <label class="trainer-label" for="trainer-weight">Weight (kg)</label>
                        <input class="trainer-input" type="number" id="trainer-weight" min="0" max="400" value="60" data-trainer-weight>
                      </div>
                    </div>

                    <label class="trainer-label" for="trainer-notes">Notes</label>
                    <textarea class="trainer-input trainer-input--textarea" id="trainer-notes" rows="2" data-trainer-notes placeholder="Tempo, cues, readiness..."></textarea>

                    <div class="trainer-actions">
                      <button type="button" class="trainer-btn trainer-btn--primary" data-trainer-add>Add movement</button>
                      <button type="button" class="trainer-btn" data-trainer-save>Save day</button>
                      <button type="button" class="trainer-btn trainer-btn--ghost" data-trainer-clear>Clear</button>
                    </div>

                    <div class="trainer-log">
                      <h5>Log</h5>
                      <ul class="trainer-log__list" data-trainer-log></ul>
                      <p class="trainer-log__empty" data-trainer-log-empty>No movements yet.</p>
                    </div>
                  </section>

                  <section class="trainer-calendar" aria-label="Training calendar">
                    <header>
                      <div class="trainer-calendar__controls">
                        <button type="button" data-trainer-month="prev" aria-label="Previous month">‹</button>
                        <span data-trainer-calendar-title></span>
                        <button type="button" data-trainer-month="next" aria-label="Next month">›</button>
                      </div>
                    </header>
                    <div class="trainer-calendar__grid" data-trainer-calendar></div>
                    <div class="trainer-tags">
                      <span data-tag="chest">Chest</span>
                      <span data-tag="shoulders">Shoulders</span>
                      <span data-tag="arms">Arms</span>
                      <span data-tag="legs">Legs</span>
                      <span data-tag="back">Back</span>
                    </div>
                  </section>

                  <section class="trainer-analytics" aria-label="Analytics">
                    <header class="trainer-analytics__header">
                      <div>
                        <h5>Trend</h5>
                        <span data-trainer-trend-subtitle>Volume vs. Quality</span>
                      </div>
                      <div class="trainer-analytics__filters">
                        <select class="trainer-input trainer-input--compact" data-trainer-filter-movement>
                          <option value="all">All Movements</option>
                        </select>
                        <select class="trainer-input trainer-input--compact" data-trainer-filter-metric>
                          <option value="volume">Volume</option>
                          <option value="reps">Reps</option>
                          <option value="weight">Weight</option>
                        </select>
                      </div>
                    </header>
                    <div class="trainer-chart" data-trainer-chart></div>
                    <div class="trainer-summary">
                      <div>Sets <strong data-trainer-total-sets>0</strong></div>
                      <div>Total load <strong data-trainer-total-load>0 kg</strong></div>
                      <div>Focus mix <strong data-trainer-focus-mix>—</strong></div>
                    </div>
                    <footer class="trainer-status" data-trainer-status data-tone="neutral">Session idle</footer>
                  </section>
                </div>
              </div>
            </div>
          </article>
        </div>
      </section>

      <!-- Contact -->
      <section id="contact" class="section" data-motion>
        <header class="section__header">
          <p class="section__eyebrow">Let's Build Together</p>
          <h2 class="section__title">Contact</h2>
          <p class="section__lead">Leave a message and let's discuss the next AI × Finance/Healthcare experiment.</p>
        </header>
        <div class="contact-grid">
          <article class="contact-highlight">
            <p class="contact-highlight__eyebrow">Response within 48h</p>
            <h3>Open to AI × Finance challenges</h3>
            <ul>
              <li>Clinical partnerships & translational studies</li>
              <li>Finance × Generative‑AI R&D</li>
              <li>Wearables and strength‑training UX</li>
            </ul>
            <div class="contact-highlight__avatars" aria-label="Recent collaborators">
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
              <span aria-hidden="true"></span>
            </div>
          </article>
          <form class="contact-form" aria-label="Contact form">
            <div class="contact-form__header">
              <span class="contact-form__badge">Message Lab</span>
              <div>
                <h4>Let&apos;s co-create</h4>
                <p>Send a note about partnerships, research, or prototype ideas.</p>
              </div>
            </div>

            <label class="contact-label" for="contact-name">Your name</label>
            <input class="contact-input" type="text" id="contact-name" name="name" placeholder="Tomohisa Sasaki" required>

            <label class="contact-label" for="contact-email">Email</label>
            <input class="contact-input" type="email" id="contact-email" name="email" placeholder="name@example.com" required>

            <label class="contact-label" for="contact-message">Message</label>
            <textarea class="contact-input contact-input--textarea" id="contact-message" name="message" rows="5" placeholder="Collaboration ideas or questions are welcome."></textarea>

            <button type="submit" class="contact-submit" aria-label="Send message">
              <span>Send</span>
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M5 12h14M13 6l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
            </button>
          </form>
        </div>
      </section>
    </main>
  </div>

  <script>
    // --- Page Loader (grumpy-turtle-41 inspired) ---
    (function(){
      const loader = document.querySelector('[data-page-loader]');
      function hide(){ if(!loader) return; loader.classList.add('is-off'); loader.classList.remove('is-on'); }
      function show(){ if(!loader) return; loader.classList.add('is-on'); loader.classList.remove('is-off'); }
      window.PageLoader = { show, hide };
      // Hide once content is interactive
      if(document.readyState === 'complete' || document.readyState === 'interactive'){
        setTimeout(hide, 300);
      } else {
        window.addEventListener('DOMContentLoaded', () => setTimeout(hide, 300));
      }
    })();

    // --- Animated scroll-spy + moving indicator + gentle float for left tabs ---
    (function () {
      const nav = document.querySelector('.profile-nav');
      const navButtons = nav.querySelectorAll('[data-nav-target]');
      navButtons.forEach((btn, i) => btn.style.setProperty('--i', i));
      const indicator = nav.querySelector('.profile-nav__indicator');
      function moveIndicator(targetBtn) {
        const active = targetBtn || nav.querySelector('.profile-nav__item.is-active') || navButtons[0];
        if (!active) return;
        const top = active.offsetTop;
        const height = active.offsetHeight;
        nav.style.setProperty('--nav-indicator-top', top + 'px');
        nav.style.setProperty('--nav-indicator-height', height + 'px');
      }
      navButtons.forEach((button) => {
        const targetSelector = button.dataset.navTarget;
        const targetSection = document.querySelector(targetSelector);
        if (!targetSection) return;
        button.addEventListener('click', () => {
          targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          navButtons.forEach((b) => b.classList.remove('is-active'));
          button.classList.add('is-active');
          moveIndicator(button);
        });
      });
      moveIndicator();

      const pairs = Array.from(navButtons).map((button) => ({
        button,
        target: document.querySelector(button.dataset.navTarget)
      })).filter(Boolean);

      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              pairs.forEach(({ button, target }) => {
                if (target === entry.target) {
                  button.classList.add('is-active');
                  moveIndicator(button);
                } else {
                  button.classList.remove('is-active');
                }
              });
            }
          });
        },
        { root: null, threshold: 0.44 }
      );
      pairs.forEach(({ target }) => target && observer.observe(target));

      let raf = null;
      nav.addEventListener('mousemove', (e) => {
        if (raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(() => {
          const r = nav.getBoundingClientRect();
          const y = (e.clientY - r.top) / r.height;
          nav.style.setProperty('--nav-mouse-y', y.toFixed(4));
        });
      });
      nav.addEventListener('mouseleave', () => { nav.style.removeProperty('--nav-mouse-y'); });
      window.addEventListener('resize', () => moveIndicator());
    })();

    // --- Reveal-on-scroll (kept, with slight stagger) ---
    (function () {
      const revealTargets = document.querySelectorAll('[data-motion]');
      if (!('IntersectionObserver' in window) || !revealTargets.length) {
        revealTargets.forEach((el) => el.classList.add('is-visible'));
        return;
      }
      const observer = new IntersectionObserver(
        (entries, obs) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              obs.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.2, rootMargin: '0px 0px -8% 0px' }
      );
      revealTargets.forEach((el, index) => {
        el.style.setProperty('--motion-index', index);
        observer.observe(el);
      });
    })();

    // --- Products filter & focus view (Uiverse-inspired chips) ---
    (function(){
      const grid = document.querySelector('.product-grid');
      const cards = Array.from(document.querySelectorAll('.product-card'));
      const chips = Array.from(document.querySelectorAll('.product-chip[data-filter]'));
      const status = document.querySelector('[data-products-status]');
      if(!grid || !cards.length || !chips.length) return;

      function selectChip(kind){
        chips.forEach(chip=>{
          const on = chip.dataset.filter === kind || (kind==='all' && chip.dataset.filter==='all');
          chip.classList.toggle('is-selected', on);
          chip.setAttribute('aria-selected', String(on));
        });
      }
      function applyFilter(kind){
        let shown = 0;
        grid.classList.toggle('is-focused', kind !== 'all');
        cards.forEach(card=>{
          const show = kind === 'all' || card.dataset.product === kind;
          card.classList.toggle('is-hidden', !show);
          if(show) shown++;
        });
        if(status){
          status.textContent = shown ? `${shown} product${shown>1?'s':''} shown` : 'No products in this category yet';
        }
      }
      chips.forEach(chip=>{
        chip.addEventListener('click', ()=>{
          const kind = chip.dataset.filter;
          selectChip(kind);
          applyFilter(kind);
        });
      });
      cards.forEach(card=>{
        card.addEventListener('click', ()=>{
          const kind = card.dataset.product || 'all';
          selectChip(kind);
          applyFilter(kind);
          grid.scrollIntoView({behavior:'smooth', block:'start'});
        });
      });
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape'){
          selectChip('all'); applyFilter('all');
        }
      });
    })();

    // --- Timeline micro-animations per item ---
    (function(){
      const items = document.querySelectorAll('.timeline__item');
      if(!items.length || !('IntersectionObserver' in window)) return;
      const obs = new IntersectionObserver((entries)=>{
        entries.forEach((entry)=>{
          if(entry.isIntersecting){
            entry.target.classList.add('is-in');
            obs.unobserve(entry.target);
          }
        });
      }, {threshold: 0.5});
      items.forEach((it, i)=>{ it.style.setProperty('--ti', i); obs.observe(it); });
    })();

    // --- Contact button magnetic hover (quick-chicken-50 vibe) ---
    (function(){
      const btn = document.querySelector('.contact-submit');
      if(!btn) return;
      let raf = null;
      btn.addEventListener('mousemove', (e)=>{
        const r = btn.getBoundingClientRect();
        const x = (e.clientX - r.left) / r.width - 0.5;
        const y = (e.clientY - r.top) / r.height - 0.5;
        if(raf) cancelAnimationFrame(raf);
        raf = requestAnimationFrame(()=> {
          btn.style.setProperty('--mx', x.toFixed(3));
          btn.style.setProperty('--my', y.toFixed(3));
        });
      });
      ['mouseleave','blur'].forEach(ev=> btn.addEventListener(ev, ()=> {
        btn.style.removeProperty('--mx'); btn.style.removeProperty('--my');
      }));
    })();

    // --- Trainer module (kept) + show mini loader on save ---
    (function () {
      const trainer = document.querySelector('[data-trainer]');
      if (!trainer) return;

      const focusLabels = {
        chest: 'Chest',
        shoulders: 'Shoulders',
        arms: 'Arms',
        legs: 'Legs',
        back: 'Back'
      };

      const focusBadges = {
        chest: 'CH',
        shoulders: 'SH',
        arms: 'AR',
        legs: 'LG',
        back: 'BK'
      };

      const movementLibrary = {
        chest: ['Flat Bench Press', 'Incline Dumbbell Press', 'Cable Fly', 'Push-Up Variations'],
        shoulders: ['Seated Dumbbell Press', 'Lateral Raise', 'Rear Delt Fly', 'Face Pull'],
        arms: ['Barbell Curl', 'Hammer Curl', 'Triceps Dip', 'Skull Crusher'],
        legs: ['Back Squat', 'Romanian Deadlift', 'Bulgarian Split Squat', 'Leg Press'],
        back: ['Deadlift', 'Bent-Over Row', 'Lat Pulldown', 'Single-Arm Row']
      };

      const metricLabels = {
        volume: 'Volume (sets×reps×weight)',
        reps: 'Total reps',
        weight: 'Average weight'
      };

      const dateInput = trainer.querySelector('[data-trainer-date]');
      const focusSelect = trainer.querySelector('[data-trainer-focus]');
      const movementSelect = trainer.querySelector('[data-trainer-movement]');
      const setsInput = trainer.querySelector('[data-trainer-sets]');
      const repsInput = trainer.querySelector('[data-trainer-reps]');
      const weightInput = trainer.querySelector('[data-trainer-weight]');
      const notesInput = trainer.querySelector('[data-trainer-notes]');
      const addButton = trainer.querySelector('[data-trainer-add]');
      const saveButton = trainer.querySelector('[data-trainer-save]');
      const clearButton = trainer.querySelector('[data-trainer-clear]');
      const logList = trainer.querySelector('[data-trainer-log]');
      const logEmpty = trainer.querySelector('[data-trainer-log-empty]');
      const calendarGrid = trainer.querySelector('[data-trainer-calendar]');
      const calendarTitle = trainer.querySelector('[data-trainer-calendar-title]');
      const periodEl = trainer.querySelector('[data-trainer-period]');
      const filterMovementSelect = trainer.querySelector('[data-trainer-filter-movement]');
      const filterMetricSelect = trainer.querySelector('[data-trainer-filter-metric]');
      const chartContainer = trainer.querySelector('[data-trainer-chart]');
      const trendSubtitleEl = trainer.querySelector('[data-trainer-trend-subtitle]');
      const totalSetsEl = trainer.querySelector('[data-trainer-total-sets]');
      const totalLoadEl = trainer.querySelector('[data-trainer-total-load]');
      const focusMixEl = trainer.querySelector('[data-trainer-focus-mix]');
      const statusEl = trainer.querySelector('[data-trainer-status]');
      const monthButtons = trainer.querySelectorAll('[data-trainer-month]');

      if (!dateInput || !focusSelect || !movementSelect || !setsInput || !repsInput || !weightInput || !notesInput ||
          !addButton || !saveButton || !clearButton || !logList || !logEmpty || !calendarGrid || !calendarTitle ||
          !periodEl || !filterMovementSelect || !filterMetricSelect || !chartContainer || !trendSubtitleEl ||
          !totalSetsEl || !totalLoadEl || !focusMixEl || !statusEl) {
        return;
      }

      let statusTimeout = null;
      const today = new Date();

      const state = {
        entries: new Map(),
        draft: [],
        selectedDate: formatISO(today),
        monthCursor: new Date(today.getFullYear(), today.getMonth(), 1)
      };

      dateInput.value = state.selectedDate;

      const formatters = {
        month: new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' })
      };

      function formatISO(date) { return date.toISOString().slice(0, 10); }
      function parseISO(iso) { const [y, m, d] = iso.split('-').map(Number); return new Date(y, m - 1, d); }

      function setStatus(message, tone = 'neutral') {
        statusEl.textContent = message;
        statusEl.setAttribute('data-tone', tone);
        if (statusTimeout) clearTimeout(statusTimeout);
        statusTimeout = window.setTimeout(() => {
          statusEl.textContent = 'Session idle';
          statusEl.setAttribute('data-tone', 'neutral');
        }, 3200);
      }

      function setMovementOptions(focus) {
        const movements = movementLibrary[focus] || [];
        movementSelect.innerHTML = '';
        movements.forEach((movement, index) => {
          const option = document.createElement('option');
          option.value = movement;
          option.textContent = movement;
          if (index === 0) option.selected = true;
          movementSelect.append(option);
        });
      }

      function getSavedEntriesFor(dateISO) { return state.entries.get(dateISO) || []; }
      function getAllSavedEntries() {
        const collection = [];
        state.entries.forEach((entries, iso) => { entries.forEach((entry) => collection.push({ iso, ...entry })); });
        return collection;
      }

      function populateMovementFilter() {
        const previous = filterMovementSelect.value || 'all';
        const movements = new Set();
        getAllSavedEntries().forEach((entry) => movements.add(entry.movement));
        const sorted = Array.from(movements).sort((a, b) => a.localeCompare(b));
        filterMovementSelect.innerHTML = '';
        const allOption = document.createElement('option');
        allOption.value = 'all'; allOption.textContent = 'All Movements'; filterMovementSelect.append(allOption);
        sorted.forEach((movement) => { const option = document.createElement('option'); option.value = movement; option.textContent = movement; filterMovementSelect.append(option); });
        if (previous !== 'all' && !movements.has(previous)) { filterMovementSelect.value = 'all'; } else { filterMovementSelect.value = previous; }
      }

      function renderLog() {
        logList.innerHTML = '';
        const saved = getSavedEntriesFor(state.selectedDate);
        const pending = state.draft;
        if (!saved.length && !pending.length) { logEmpty.hidden = false; return; }
        logEmpty.hidden = true;
        const fragment = document.createDocumentFragment();
        const appendEntry = (entry, statusLabel) => {
          const item = document.createElement('li');
          item.className = 'trainer-log__item';
          item.innerHTML = `
            <div class="trainer-log__meta">
              <span>${statusLabel}</span>
              <span>${focusLabels[entry.focus]}</span>
              <span>${entry.sets}×${entry.reps} @ ${entry.weight}kg</span>
            </div>
            <p class="trainer-log__title">${entry.movement}</p>
            <p class="trainer-log__notes">${entry.notes ? entry.notes : 'No notes provided.'}</p>
          `;
          fragment.append(item);
        };
        saved.forEach((entry) => appendEntry(entry, 'Saved'));
        pending.forEach((entry) => appendEntry(entry, 'Pending'));
        logList.append(fragment);
      }

      function renderCalendar() {
        calendarGrid.innerHTML = '';
        const year = state.monthCursor.getFullYear();
        const month = state.monthCursor.getMonth();
        const firstOfMonth = new Date(year, month, 1);
        const startingDay = firstOfMonth.getDay();
        const startDate = new Date(year, month, 1 - startingDay);
        const totalCells = 42;
        calendarTitle.textContent = formatters.month.format(firstOfMonth);
        for (let i = 0; i < totalCells; i++) {
          const current = new Date(startDate);
          current.setDate(startDate.getDate() + i);
          const iso = formatISO(current);
          const dayButton = document.createElement('button');
          dayButton.type = 'button';
          dayButton.className = 'trainer-day';
          dayButton.textContent = String(current.getDate());
          if (current.getMonth() !== month) dayButton.classList.add('is-other');
          if (iso === state.selectedDate) dayButton.classList.add('is-selected');
          const saved = getSavedEntriesFor(iso);
          if (saved.length) {
            dayButton.dataset.hasSession = 'true';
            const focusCount = saved.reduce((acc, entry) => { acc[entry.focus] = (acc[entry.focus] || 0) + 1; return acc; }, {});
            const dominant = Object.entries(focusCount).sort((a, b) => b[1] - a[1])[0][0];
            dayButton.dataset.focus = dominant;
            const badge = document.createElement('span');
            badge.className = 'trainer-day__badge';
            badge.textContent = focusBadges[dominant] || dominant.toUpperCase();
            dayButton.append(badge);
          }
          dayButton.addEventListener('click', () => {
            state.selectedDate = iso;
            state.draft = [];
            dateInput.value = iso;
            renderAll();
          });
          calendarGrid.append(dayButton);
        }
      }

      function renderChart() {
        chartContainer.innerHTML = '';
        const metric = filterMetricSelect.value;
        const movement = filterMovementSelect.value;
        const entries = getAllSavedEntries().filter((entry) => movement === 'all' || entry.movement === movement);
        if (!entries.length) {
          const empty = document.createElement('p');
          empty.className = 'trainer-chart__empty';
          empty.textContent = 'Not enough log entries';
          chartContainer.append(empty);
          return;
        }
        const grouped = entries.reduce((acc, entry) => { acc[entry.iso] = acc[entry.iso] || []; acc[entry.iso].push(entry); return acc; }, {});
        const points = Object.entries(grouped)
          .map(([date, items]) => {
            const value = items.reduce((total, item) => {
              if (metric === 'volume') return total + item.sets * item.reps * item.weight;
              if (metric === 'reps') return total + item.sets * item.reps;
              return total + item.weight;
            }, 0);
            return { date, value: metric === 'weight' ? value / items.length : value };
          })
          .sort((a, b) => a.date.localeCompare(b.date));
        trendSubtitleEl.textContent = metricLabels[metric];
        const svgNS = 'http://www.w3.org/2000/svg';
        const svg = document.createElementNS(svgNS, 'svg');
        const width = 320;
        const height = 160;
        svg.setAttribute('viewBox', `0 0 ${width} ${height}`);
        svg.setAttribute('role', 'img');
        svg.setAttribute('aria-label', 'Training trend chart');
        const maxVal = Math.max(...points.map((p) => p.value));
        const minVal = Math.min(...points.map((p) => p.value));
        const range = maxVal - minVal || 1;
        const pathData = points.map((p, i) => {
          const x = (i / (points.length - 1 || 1)) * (width - 20) + 10;
          const y = height - ((p.value - minVal) / range) * (height - 20) - 10;
          return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
        }).join(' ');
        const path = document.createElementNS(svgNS, 'path');
        path.setAttribute('d', pathData);
        path.setAttribute('fill', 'none');
        path.setAttribute('stroke', '#a868ff');
        path.setAttribute('stroke-width', '2.5');
        path.setAttribute('stroke-linecap', 'round');
        svg.append(path);
        points.forEach((p, i) => {
          const x = (i / (points.length - 1 || 1)) * (width - 20) + 10;
          const y = height - ((p.value - minVal) / range) * (height - 20) - 10;
          const circle = document.createElementNS(svgNS, 'circle');
          circle.setAttribute('cx', x);
          circle.setAttribute('cy', y);
          circle.setAttribute('r', '4');
          circle.setAttribute('fill', '#7a8cff');
          svg.append(circle);
        });
        chartContainer.append(svg);
      }

      function renderSummary() {
        let totalSets = 0;
        let totalLoad = 0;
        const focusCounter = {};
        state.entries.forEach((entries) => {
          entries.forEach((entry) => {
            totalSets += entry.sets;
            totalLoad += entry.sets * entry.reps * entry.weight;
            focusCounter[entry.focus] = (focusCounter[entry.focus] || 0) + 1;
          });
        });
        totalSetsEl.textContent = totalSets;
        totalLoadEl.textContent = Math.round(totalLoad) + ' kg';
        if (!Object.keys(focusCounter).length) { focusMixEl.textContent = '—'; return; }
        focusMixEl.textContent = Object.entries(focusCounter)
          .sort((a, b) => b[1] - a[1])
          .map(([focus, count]) => `${focusLabels[focus]} (${count})`)
          .join(' · ');
      }

      function renderPeriod() {
        const selected = parseISO(state.selectedDate);
        const start = new Date(selected);
        const day = selected.getDay();
        const diffToMonday = (day + 6) % 7;
        start.setDate(selected.getDate() - diffToMonday);
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        const formatter = new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric' });
        periodEl.textContent = `${formatter.format(start)} – ${formatter.format(end)}`;
      }

      function renderAll() { renderLog(); renderCalendar(); populateMovementFilter(); renderChart(); renderSummary(); renderPeriod(); }

      function addEntry() {
        const movement = movementSelect.value;
        if (!movement) { setStatus('Select a movement', 'warn'); return; }
        const focus = focusSelect.value;
        const sets = Number(setsInput.value) || 1;
        const reps = Number(repsInput.value) || 1;
        const weight = Number(weightInput.value) || 0;
        const notes = (notesInput.value || '').trim();
        state.draft.push({ date: state.selectedDate, focus, movement, sets, reps, weight, notes });
        notesInput.value = '';
        setStatus(`${movement} added`, 'success'); renderLog();
      }

      function commitDay() {
        if (!state.draft.length) { setStatus('Add at least one movement', 'warn'); return; }
        window.PageLoader && window.PageLoader.show();
        setTimeout(()=>{
          const current = getSavedEntriesFor(state.selectedDate);
          state.entries.set(state.selectedDate, [...current, ...state.draft]);
          state.draft = [];
          setStatus(`${state.selectedDate} saved`, 'success');
          renderAll();
          window.PageLoader && window.PageLoader.hide();
        }, 600);
      }

      function clearComposer() {
        state.draft = [];
        notesInput.value = '';
        setsInput.value = '3';
        repsInput.value = '8';
        weightInput.value = '60';
        setMovementOptions(focusSelect.value);
        renderLog();
        setStatus('Reset complete', 'neutral');
      }

      function shiftMonth(direction) { const delta = direction === 'next' ? 1 : -1; state.monthCursor.setMonth(state.monthCursor.getMonth() + delta); renderCalendar(); }

      focusSelect.addEventListener('change', () => setMovementOptions(focusSelect.value));
      dateInput.addEventListener('change', () => {
        const next = dateInput.value || formatISO(new Date());
        state.selectedDate = next;
        state.draft = [];
        state.monthCursor = new Date(Number(next.slice(0, 4)), Number(next.slice(5, 7)) - 1, 1);
        renderAll();
      });
      addButton.addEventListener('click', addEntry);
      saveButton.addEventListener('click', commitDay);
      clearButton.addEventListener('click', clearComposer);
      monthButtons.forEach((button) => { button.addEventListener('click', () => shiftMonth(button.dataset.trainerMonth)); });
      filterMovementSelect.addEventListener('change', renderChart);
      filterMetricSelect.addEventListener('change', renderChart);

      setMovementOptions(focusSelect.value);
      renderAll();
    })();
  </script>
</body>
</html>
